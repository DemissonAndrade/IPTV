class v extends Event{track;constructor(e,n){super(e),this.track=n.track}}const g=new WeakMap;function i(t){return g.get(t)??x(t,{})}function x(t,e){let n=g.get(t);return n||g.set(t,n={}),Object.assign(n,e)}function p(t,e){const n=t.videoTracks;i(e).media=t,i(e).renditionSet||(i(e).renditionSet=new Set);const r=i(n).trackSet;r.add(e);const o=r.size-1;o in y.prototype||Object.defineProperty(y.prototype,o,{get(){return[...i(this).trackSet][o]}}),queueMicrotask(()=>{n.dispatchEvent(new v("addtrack",{track:e}))})}function T(t){const e=i(t).media?.videoTracks;if(!e)return;i(e).trackSet.delete(t),queueMicrotask(()=>{e.dispatchEvent(new v("removetrack",{track:t}))})}function A(t){const e=i(t).media.videoTracks??[];let n=!1;for(const r of e)r!==t&&(r.selected=!1,n=!0);if(n){if(i(e).changeRequested)return;i(e).changeRequested=!0,queueMicrotask(()=>{delete i(e).changeRequested,e.dispatchEvent(new Event("change"))})}}class y extends EventTarget{#e;#t;#i;constructor(){super(),i(this).trackSet=new Set}get#n(){return i(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(e){return[...this.#n].find(n=>n.id===e)??null}get selectedIndex(){return[...this.#n].findIndex(e=>e.selected)}get onaddtrack(){return this.#e}set onaddtrack(e){this.#e&&(this.removeEventListener("addtrack",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#t}set onremovetrack(e){this.#t&&(this.removeEventListener("removetrack",this.#t),this.#t=void 0),typeof e=="function"&&(this.#t=e,this.addEventListener("removetrack",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class k extends Event{rendition;constructor(e,n){super(e),this.rendition=n.rendition}}function V(t,e){const n=i(t).media.videoRenditions;i(e).media=i(t).media,i(e).track=t;const r=i(t).renditionSet;r.add(e);const o=r.size-1;o in R.prototype||Object.defineProperty(R.prototype,o,{get(){return u(this)[o]}}),queueMicrotask(()=>{t.selected&&n.dispatchEvent(new k("addrendition",{rendition:e}))})}function I(t){const e=i(t).media.videoRenditions,n=i(t).track;i(n).renditionSet.delete(t),queueMicrotask(()=>{i(t).track.selected&&e.dispatchEvent(new k("removerendition",{rendition:t}))})}function P(t){const e=i(t).media.videoRenditions;!e||i(e).changeRequested||(i(e).changeRequested=!0,queueMicrotask(()=>{delete i(e).changeRequested,i(t).track.selected&&e.dispatchEvent(new Event("change"))}))}function u(t){return[...i(t).media.videoTracks].filter(n=>n.selected).flatMap(n=>[...i(n).renditionSet])}class R extends EventTarget{#e;#t;#i;[Symbol.iterator](){return u(this).values()}get length(){return u(this).length}getRenditionById(e){return u(this).find(n=>`${n.id}`==`${e}`)??null}get selectedIndex(){return u(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[n,r]of u(this).entries())r.selected=n===e}get onaddrendition(){return this.#e}set onaddrendition(e){this.#e&&(this.removeEventListener("addrendition",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#t}set onremoverendition(e){this.#t&&(this.removeEventListener("removerendition",this.#t),this.#t=void 0),typeof e=="function"&&(this.#t=e,this.addEventListener("removerendition",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class ${src;id;width;height;bitrate;frameRate;codec;#e=!1;get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,P(this))}}class q{id;kind;label="";language="";sourceBuffer;#e=!1;addRendition(e,n,r,o,d,s){const c=new $;return c.src=e,c.width=n,c.height=r,c.frameRate=s,c.bitrate=d,c.codec=o,V(this,c),c}removeRendition(e){I(e)}get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,e===!0&&A(this))}}function O(t,e){const n=i(t).media.audioRenditions;i(e).media=i(t).media,i(e).track=t;const r=i(t).renditionSet;r.add(e);const o=r.size-1;o in l.prototype||Object.defineProperty(l.prototype,o,{get(){return h(this)[o]}}),queueMicrotask(()=>{t.enabled&&n.dispatchEvent(new k("addrendition",{rendition:e}))})}function j(t){const e=i(t).media.audioRenditions,n=i(t).track;i(n).renditionSet.delete(t),queueMicrotask(()=>{i(t).track.enabled&&e.dispatchEvent(new k("removerendition",{rendition:t}))})}function B(t){const e=i(t).media.audioRenditions;!e||i(e).changeRequested||(i(e).changeRequested=!0,queueMicrotask(()=>{delete i(e).changeRequested,i(t).track.enabled&&e.dispatchEvent(new Event("change"))}))}function h(t){return[...i(t).media.audioTracks].filter(n=>n.enabled).flatMap(n=>[...i(n).renditionSet])}class l extends EventTarget{#e;#t;#i;[Symbol.iterator](){return h(this).values()}get length(){return h(this).length}getRenditionById(e){return h(this).find(n=>`${n.id}`==`${e}`)??null}get selectedIndex(){return h(this).findIndex(e=>e.selected)}set selectedIndex(e){for(const[n,r]of h(this).entries())r.selected=n===e}get onaddrendition(){return this.#e}set onaddrendition(e){this.#e&&(this.removeEventListener("addrendition",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addrendition",e))}get onremoverendition(){return this.#t}set onremoverendition(e){this.#t&&(this.removeEventListener("removerendition",this.#t),this.#t=void 0),typeof e=="function"&&(this.#t=e,this.addEventListener("removerendition",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class z{src;id;bitrate;codec;#e=!1;get selected(){return this.#e}set selected(e){this.#e!==e&&(this.#e=e,B(this))}}function L(t,e){const n=t.audioTracks;i(e).media=t,i(e).renditionSet||(i(e).renditionSet=new Set);const r=i(n).trackSet;r.add(e);const o=r.size-1;o in E.prototype||Object.defineProperty(E.prototype,o,{get(){return[...i(this).trackSet][o]}}),queueMicrotask(()=>{n.dispatchEvent(new v("addtrack",{track:e}))})}function m(t){const e=i(t).media?.audioTracks;if(!e)return;i(e).trackSet.delete(t),queueMicrotask(()=>{e.dispatchEvent(new v("removetrack",{track:t}))})}function F(t){const e=i(t).media.audioTracks;!e||i(e).changeRequested||(i(e).changeRequested=!0,queueMicrotask(()=>{delete i(e).changeRequested,e.dispatchEvent(new Event("change"))}))}class E extends EventTarget{#e;#t;#i;constructor(){super(),i(this).trackSet=new Set}get#n(){return i(this).trackSet}[Symbol.iterator](){return this.#n.values()}get length(){return this.#n.size}getTrackById(e){return[...this.#n].find(n=>n.id===e)??null}get onaddtrack(){return this.#e}set onaddtrack(e){this.#e&&(this.removeEventListener("addtrack",this.#e),this.#e=void 0),typeof e=="function"&&(this.#e=e,this.addEventListener("addtrack",e))}get onremovetrack(){return this.#t}set onremovetrack(e){this.#t&&(this.removeEventListener("removetrack",this.#t),this.#t=void 0),typeof e=="function"&&(this.#t=e,this.addEventListener("removetrack",e))}get onchange(){return this.#i}set onchange(e){this.#i&&(this.removeEventListener("change",this.#i),this.#i=void 0),typeof e=="function"&&(this.#i=e,this.addEventListener("change",e))}}class b{id;kind;label="";language="";sourceBuffer;#e=!1;addRendition(e,n,r){const o=new z;return o.src=e,o.codec=n,o.bitrate=r,O(this,o),o}removeRendition(e){j(e)}get enabled(){return this.#e}set enabled(e){this.#e!==e&&(this.#e=e,F(this))}}const S=f(globalThis.HTMLMediaElement,"video"),w=f(globalThis.HTMLMediaElement,"audio");function D(t){if(!t?.prototype)return t;const e=f(t,"video");(!e||`${e}`.includes("[native code]"))&&Object.defineProperty(t.prototype,"videoTracks",{get(){return M(this)}});const n=f(t,"audio");(!n||`${n}`.includes("[native code]"))&&Object.defineProperty(t.prototype,"audioTracks",{get(){return H(this)}}),"addVideoTrack"in t.prototype||(t.prototype.addVideoTrack=function(d,s="",c=""){const a=new q;return a.kind=d,a.label=s,a.language=c,p(this,a),a}),"removeVideoTrack"in t.prototype||(t.prototype.removeVideoTrack=T),"addAudioTrack"in t.prototype||(t.prototype.addAudioTrack=function(d,s="",c=""){const a=new b;return a.kind=d,a.label=s,a.language=c,L(this,a),a}),"removeAudioTrack"in t.prototype||(t.prototype.removeAudioTrack=m),"videoRenditions"in t.prototype||Object.defineProperty(t.prototype,"videoRenditions",{get(){return r(this)}});const r=d=>{let s=i(d).videoRenditions;return s||(s=new R,i(s).media=d,i(d).videoRenditions=s),s};"audioRenditions"in t.prototype||Object.defineProperty(t.prototype,"audioRenditions",{get(){return o(this)}});const o=d=>{let s=i(d).audioRenditions;return s||(s=new l,i(s).media=d,i(d).audioRenditions=s),s};return t}function f(t,e){if(t?.prototype)return Object.getOwnPropertyDescriptor(t.prototype,`${e}Tracks`)?.get}function M(t){let e=i(t).videoTracks;if(!e&&(e=new y,i(t).videoTracks=e,S)){const n=S.call(t.nativeEl??t);for(const r of n)p(t,r);n.addEventListener("change",()=>{e.dispatchEvent(new Event("change"))}),n.addEventListener("addtrack",r=>{if([...e].some(o=>o instanceof q)){for(const o of n)T(o);return}p(t,r.track)}),n.addEventListener("removetrack",r=>{T(r.track)})}return e}function H(t){let e=i(t).audioTracks;if(!e&&(e=new E,i(t).audioTracks=e,w)){const n=w.call(t.nativeEl??t);for(const r of n)L(t,r);n.addEventListener("change",()=>{e.dispatchEvent(new Event("change"))}),n.addEventListener("addtrack",r=>{if([...e].some(o=>o instanceof b)){for(const o of n)m(o);return}L(t,r.track)}),n.addEventListener("removetrack",r=>{m(r.track)})}return e}export{D as M};
